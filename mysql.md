# mysqlä»‹ç»

#### mysqlç‰¹ç‚¹

1. å…³ç³»å‹æ•°æ®åº“ã€‚
2. åŸºäºå®¢æˆ·ç«¯æœåŠ¡å™¨(C/S)æ¨¡å‹ã€‚
3. æ•°æ®è¢«å­˜å‚¨ä¸ºä¸€ä¸ªäºŒç»´è¡¨ï¼Œä¸€è¡Œæ•°æ®è¢«ç§°ä¸ºè®°å½•ï¼Œåˆ—è¢«ç§°ä¸ºå­—æ®µæˆ–å±æ€§ã€‚å› ä¸ºæ˜¯ä¸€è¡Œä¸€è¡Œå­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥mysqlåˆè¢«ç§°ä¸ºè¡Œå¼æ•°æ®åº“ã€‚
4. æ”¯æŒæ’ä»¶å¼çš„å­˜å‚¨å¼•æ“ï¼Œå¸¸è§çš„å­˜å‚¨å¼•æ“æœ‰innodbã€myisamã€memoryç­‰ã€‚
5. æœåŠ¡å™¨æ¨¡å‹é‡‡ç”¨select+å¯ä¼¸ç¼©çš„çº¿ç¨‹æ± æ¥å®ç°ç½‘ç»œæœåŠ¡å™¨ã€‚

**mysqlä½¿ç”¨selectè€Œä¸æ˜¯epollçš„åŸå› **ï¼š

å› ä¸ºmysqlå­˜å‚¨æ•°æ®ä¼šæ¶‰åŠç£ç›˜ioï¼Œé€Ÿåº¦è¾ƒæ…¢ã€‚æ­¤æ—¶å°±ç®—é€šè¿‡epollæ¥è¾ƒå¿«çš„æ¥æ”¶ç½‘ç»œioï¼Œä¹Ÿæ— æ³•å°†å…¶å¿«é€Ÿå­˜å‚¨åˆ°ç£ç›˜ã€‚æ‰€ä»¥æ¥æ”¶ç½‘ç»œioæ²¡æœ‰å¿…è¦è¿‡å¿«ï¼Œåªéœ€è¦å°†ç½‘ç»œioå’Œç£ç›˜ioçš„é€Ÿåº¦ç›¸åŒ¹é…å³å¯ã€‚

#### EDBMSã€RDBã€tableä»‹ç»

- mysqlå…¶å®æ˜¯å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆEDBMS)
- mysqlä¸­å¯ä»¥åˆ›å»ºè®¸å¤šçš„å…³ç³»å‹æ•°æ®åº“(RDB)
- ä¸€ä¸ªRDBä¸­å¯ä»¥åˆ›å»ºå¤šä¸ªè¡¨(table)---äºŒç»´è¡¨

å¦‚ä¸‹æ‰€ç¤ºï¼Œchatå…¶å®å°±æ˜¯ä¸€ä¸ªRDBï¼Œuserå°±æ˜¯ä¸€ä¸ªè¡¨ã€‚æˆ‘ä»¬ä¸€èˆ¬è¯´mysqlæ˜¯æ•°æ®åº“åªæ˜¯å¤§å®¶çš„ä¹ æƒ¯å«æ³•ç½¢äº†ï¼ŒçœŸæ­£çš„æ•°æ®åº“å…¶å®æ˜¯åœ¨mysqlé‡Œé¢åˆ›å»ºçš„æ‰å«æ•°æ®åº“ï¼Œè€Œmysqlå…¶å®æ˜¯å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚

```mysql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| chat               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.01 sec)

mysql> use chat;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+----------------+
| Tables_in_chat |
+----------------+
| allgroup       |
| friend         |
| groupuser      |
| offlinemessage |
| user           |
+----------------+
5 rows in set (0.00 sec)
```

#### é…ç½®ç›®å½•ä»‹ç»

mysqlçš„é»˜è®¤ç›®å½•åœ¨`/var/lib/mysql`

é…ç½®æ–‡ä»¶å°±åœ¨`/etc/my.cnf`ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥è‡ªè¡Œåˆ›å»ºï¼Œåªéœ€è¦åœ¨`[mysqld]`ä¸‹é¢å†™é…ç½®ä¿¡æ¯å³å¯ã€‚å¦‚ä¸‹ä¸ºè®¾ç½®mysqlçš„é»˜è®¤ç¼–ç æ ¼å¼å’Œé»˜è®¤å­˜å‚¨å¼•æ“ï¼š

```mysql
[mysqld]

character-set-server=utf8
default-storage-engine=INNODB
```

# æ•°æ®ç±»å‹

åˆç†å®šä¹‰æ¯ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘æ•°æ®çš„å­˜å‚¨å¤§å°ï¼Œæ‰€ä»¥å®šä¹‰ç±»å‹å‰å¿…é¡»è€ƒè™‘ä»”ç»†ï¼

#### æ•°å€¼ç±»å‹

![image-20240720215010811](C:\Users\Mr.Helen\AppData\Roaming\Typora\typora-user-images\image-20240720215010811.png)

åœ¨ä½¿ç”¨æµ®ç‚¹ç±»å‹æ—¶éœ€è¦æ³¨æ„ç²¾åº¦é—®é¢˜ï¼Œå¯¹äºé«˜ç²¾åº¦è¦æ±‚å»ºè®®ä½¿ç”¨decimalã€‚

- å¯¹äºfloatå’Œdoubleç±»å‹ï¼Œå¦‚æœå‘ç”Ÿäº†æ•°æ®æº¢å‡ºé‚£ä¹ˆä¼šç›´æ¥å¯¼è‡´æ•°æ®è¢«æˆªæ–­ã€‚ä½†æ˜¯å¯¹äºdecimalç±»å‹ï¼Œä¼šç›´æ¥æŠ¥é”™ã€‚
- floatçš„ç²¾åº¦é€šå¸¸ç”±6-7ä¸ªæœ‰æ•ˆä½ï¼Œdoubleæ˜¯15-16ä¸ªæœ‰æ•ˆä½ï¼Œè€Œdecimalæœ‰28ä¸ªæœ‰æ•ˆä½ã€‚

#### å­—ç¬¦ä¸²ç±»å‹

![image-20240720215439268](C:\Users\Mr.Helen\AppData\Roaming\Typora\typora-user-images\image-20240720215439268.png)

**char vs varcharï¼š**charæ˜¯å›ºå®šé•¿åº¦ï¼Œvarcharæ˜¯å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ç±»å‹ã€‚

**ç±»å‹åæ‹¬å·çš„æ•°å­—ï¼š**

- å­—ç¬¦ä¸²ç±»å‹åæ‹¬å·çš„æ•°å­—è¡¨ç¤ºå­—ç¬¦æ•°ï¼ˆå­—èŠ‚æ•°ï¼‰--- ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚
- æ•°å€¼ç±»å‹åæ‹¬å·çš„æ•°å­—è¡¨ç¤ºæ˜¾ç¤ºçš„å®½åº¦

```mysql
# å³ä½¿å­˜å…¥"hello",ä»ç„¶ä¼šç”¨12ä¸ªå­—èŠ‚æ¥è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœå­—ç¬¦ä¸²è¶…è¿‡12å­—èŠ‚ï¼Œé‚£ä¹ˆä¼šå‘ç”Ÿæˆªæ–­
CHAR(12) VARCHAR(12)

# æ— è®ºæ’å…¥ä»€ä¹ˆæ•°å­—ï¼Œéƒ½åªä¼šä½¿ç”¨5ä¸ªå­—èŠ‚æ¥è¿›è¡Œå­˜å‚¨ã€‚
# å½“æ•°å€¼å­—ç¬¦é•¿åº¦å°äºæŒ‡å®šæ˜¾ç¤ºå®½åº¦æ—¶ï¼Œä¼šç”¨ç©ºæ ¼æˆ–0å¡«å……ï¼Œå¦‚æ’å…¥2é‚£ä¹ˆå¯èƒ½ä¼šè¢«å¡«å……ä¸º00002
# å½“æ•°å€¼å­—ç¬¦é•¿åº¦å¤§äºæŒ‡å®šæ˜¾ç¤ºå®½åº¦æ—¶ï¼Œä¸ä¼šæˆªæ–­è€Œæ˜¯æ­£å¸¸æ˜¾ç¤ºï¼Œå¦‚æ’å…¥123456é‚£ä¹ˆä¼šæ­£å¸¸æ˜¾ç¤º123456
INT(5)
```

psï¼šmysqlä¸­å­—ç¬¦ä¸²ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼Œä»è€Œä¿æŒå­—é¢å€¼ã€‚

#### æ—¥æœŸå’Œæ—¶é—´ç±»å‹

![image-20240720220243299](C:\Users\Mr.Helen\AppData\Roaming\Typora\typora-user-images\image-20240720220243299.png)

psï¼šTIMESTAMPä¼šè‡ªåŠ¨æ›´æ–°æ—¶é—´ï¼Œè€ŒDATETIMEéœ€è¦æ‰‹åŠ¨æ›´æ–°æ—¶é—´ã€‚

å®é™…é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹çš„æ¬¡æ•°ä¸å¤šï¼Œä¸»è¦æ˜¯åˆ©ç”¨`now()`å’Œ`unix_timestamp()`æ¥è®¾ç½®æ—¶é—´ã€‚ç›´æ¥æŠŠæ—¶é—´æˆ³è¿›è¡Œå­˜å‚¨æ–¹ä¾¿å¾—å¤šï¼Œç„¶ååœ¨ä»£ç ä¸­è½¬æ¢ä¸ºæ—¥æœŸå°±å¥½äº†ã€‚

```mysql
mysql> select now();
+---------------------+
| now()               |
+---------------------+
| 2024-07-20 22:04:53 |
+---------------------+
1 row in set (0.00 sec)

mysql> select unix_timestamp(now());
+-----------------------+
| unix_timestamp(now()) |
+-----------------------+
|            1721484308 |
+-----------------------+
1 row in set (0.00 sec)
```

#### enumå’Œset

é™åˆ¶å­—æ®µåªèƒ½å–å›ºå®šçš„å€¼ã€‚ä¸åŒç‚¹åœ¨äºenumåªèƒ½å–å”¯ä¸€ä¸€ä¸ªå€¼ï¼Œè€Œsetå¯ä»¥å–ä»»æ„å¤šä¸ªå€¼ã€‚

æ¯”å¦‚æ€§åˆ«å­—æ®µï¼Œå°±å¯ä»¥è®¾ç½®ä¸ºenumï¼Œå› ä¸ºå…¨ä¸–ç•Œçš„äººä¹Ÿåªæœ‰ç”·å¥³ä¸¤ä¸ªæ€§åˆ«ã€‚ï¼ˆä¸è¿‡å¥½åƒç¾ä¸½å›½æœ‰å‡ åç§æ€§åˆ«ğŸ˜¢ï¼‰

# è¿ç®—ç¬¦

#### ç®—æœ¯è¿ç®—ç¬¦

![image-20240720220833880](C:\Users\Mr.Helen\AppData\Roaming\Typora\typora-user-images\image-20240720220833880.png)

ä¸¾ä¾‹ï¼šå°†ç”¨æˆ·çš„å¹´é¾„åŠ 1`update user set age=age+1;`

#### é€»è¾‘è¿ç®—ç¬¦

å»ºè®®ä½¿ç”¨mysqlå®šä¹‰çš„`NOT AND OR`ï¼Œè€Œä¸æ˜¯`! && ||`ã€‚

![image-20240720220847759](C:\Users\Mr.Helen\AppData\Roaming\Typora\typora-user-images\image-20240720220847759.png)

ä¸¾ä¾‹ï¼šæŸ¥è¯¢æ€§åˆ«ä¸ºç”·ä¸”æˆç»©å¤§äº90åˆ†çš„å­¦ç”Ÿ`select * from student where sex='M' and score>='90.0';`

#### æ¯”è¾ƒè¿ç®—ç¬¦

![image-20240720220947557](C:\Users\Mr.Helen\AppData\Roaming\Typora\typora-user-images\image-20240720220947557.png)

å¦‚æœå­—æ®µçš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è®¾ç½®ä¸º`not null`ï¼Œé‚£ä¹ˆè¯¥å­—æ®µçš„å–å€¼æœ‰å¯èƒ½ä¸ºnullã€‚å¦‚æœè¦åˆ¤æ–­å…¶å€¼æ˜¯å¦ä¸ºnullï¼Œå¿…é¡»ä½¿ç”¨`is (not) null`ï¼Œè€Œä¸èƒ½ä½¿ç”¨`== null`ã€‚

ä½¿ç”¨likeæ—¶éœ€è¦æ³¨æ„æ˜¯å¦ä¼šç”¨åˆ°ç´¢å¼•ã€‚å‡è®¾å­—æ®µå…·æœ‰ç´¢å¼•ï¼Œå¦‚æœé€šé…ç¬¦åœ¨å­—ç¬¦ä¸²çš„ä¸­é—´æˆ–æœ«å°¾é‚£ä¹ˆå¯ä»¥ç”¨åˆ°ï¼Œå¦‚æœé€šé…ç¬¦åœ¨å­—ç¬¦ä¸²çš„å‰é¢é‚£ä¹ˆæ— æ³•ç”¨åˆ°ç´¢å¼•ã€‚

# å®Œæ•´æ€§çº¦æŸ

ä¸€å…±æœ‰6å¤§çº¦æ•°ã€‚

#### ä¸»é”®çº¦æŸ(primary key)

ä¸å¯ä»¥å–ç©ºå€¼(null)ï¼Œä¸å¯ä»¥é‡å¤ï¼Œä¸”ä¸€ä¸ªè¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚

innodbè¦æ±‚è¡¨å¿…é¡»å…·æœ‰ä¸»é”®ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆå®ƒä¼šé»˜è®¤æ·»åŠ ä¸€åˆ—æ•´å‹å­—æ®µä½œä¸ºä¸»é”®ï¼Œå½“ç„¶è¿™å’Œå®ƒçš„ç´¢å¼•åº•å±‚å®ç°æœ‰å…³ï¼Œåç»­ä»‹ç»ã€‚

#### è‡ªå¢é”®çº¦æŸ(auto_increment)

å¤§éƒ¨åˆ†çš„æ•´å‹ä¸»é”®éƒ½ä¼šè®¾ç½®ä¸ºè‡ªå¢é”®ï¼Œä»è€Œå¯ä»¥ä¸ç”¨æ‰‹åŠ¨è®¾ç½®ä¸»é”®idï¼Œå› ä¸ºmysqlä¼šè‡ªåŠ¨åœ°é¡ºåºç”Ÿæˆä¸»é”®ã€‚

#### å”¯ä¸€é”®çº¦æŸ(unique)

å¯ä»¥å–ç©ºå€¼(null)ï¼Œä¸å¯ä»¥é‡å¤ï¼Œä¸”ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€é”®ã€‚ï¼ˆå’Œä¸»é”®å¯¹æ¯”ï¼‰

#### é»˜è®¤å€¼çº¦æŸ(default)

ä¸»è¦æ˜¯ç”¨äºæ·»åŠ ä¸€ä¸ªé»˜è®¤å€¼ã€‚

#### å¤–é”®çº¦æŸ(foreign key)

å¤–é”®çš„ä½œç”¨æ˜¯è®©å¤šä¸ªè¡¨çš„å­—æ®µäº§ç”Ÿå…³è”ã€‚

å‡è®¾æœ‰ä¸€å¼ å­¦ç”Ÿè¡¨å’Œå­¦ç”Ÿè€ƒè¯•è¡¨ï¼Œæœ‰ä¸€å¤©å­¦ç”Ÿä¿¡æ¯è¢«ç§»é™¤å‡ºå­¦ç”Ÿè¡¨äº†ï¼Œä½†æ˜¯å­¦ç”Ÿè€ƒè¯•è¡¨ä¸­ä»ç„¶æœ‰è¯¥å­¦ç”Ÿï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®å°±æ˜¯è„æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´èµ„æºçš„æµªè´¹ã€‚å¤–é”®çš„ä½œç”¨å°±ç±»ä¼¼äºå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªæ•°æ®è¿˜å…³è”äº†ä¸€äº›å…¶ä»–è¡¨ï¼Œä½ éœ€è¦æŠŠå…¶ä»–è¡¨çš„æ•°æ®ä¹Ÿåˆ é™¤æ‰æ‰å¯ä»¥ã€‚

ç°ä»£é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤–é”®ã€å­˜å‚¨å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰å‡ ä¹ä¸ä¼šå†ä½¿ç”¨äº†ã€‚ç”±äºè¿™äº›é™åˆ¶é€»è¾‘æ“ä½œä¸åº”äº¤ç»™mysqlå¤„ç†ï¼Œmysqlä¼šæ¶‰åŠç£ç›˜ioæ˜¯å¾ˆæœ‰å¯èƒ½è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥è®©mysqlå°½å¯èƒ½å¤„ç†æ ¸å¿ƒæ“ä½œï¼ˆå¢åˆ æŸ¥æ”¹ï¼‰ã€‚æ¯”å¦‚è¿™äº›è¡¨ä¸è¡¨çš„å…³ç³»å¤„ç†äº¤ç»™ä¸šåŠ¡ä»£ç ï¼Œä»è€Œå‡è½»mysqlçš„å·¥ä½œå‹åŠ›ã€‚

#### ä¸¾ä¾‹

```mysql
mysql> CREATE TABLE user(
    -> id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT'ç”¨æˆ·ä¸»é”®id',
    -> age TINYINT UNSIGNED NOT NULL UNIQUE DEFAULT 18 COMMENT'ç”¨æˆ·å¹´é¾„é»˜è®¤ä¸º18',
    -> sex ENUM('male', 'famale') );
Query OK, 0 rows affected (0.03 sec)

mysql> desc user;
+-------+-----------------------+------+-----+---------+----------------+
| Field | Type                  | Null | Key | Default | Extra          |
+-------+-----------------------+------+-----+---------+----------------+
| id    | int unsigned          | NO   | PRI | NULL    | auto_increment |
| age   | tinyint unsigned      | NO   | UNI | 18      |                |
| sex   | enum('male','famale') | YES  |     | NULL    |                |
+-------+-----------------------+------+-----+---------+----------------+
3 rows in set (0.01 sec)

mysql> CREATE TABLE user(
    -> id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT'ç”¨æˆ·ä¸»é”®id',
    -> age TINYINT UNSIGNED NOT NULL UNIQUE DEFAULT 18 COMMENT'ç”¨æˆ·å¹´é¾„é»˜è®¤ä¸º18',
    -> sex ENUM('male', 'famale') );
Query OK, 0 rows affected (0.03 sec)

mysql> desc user\G
*************************** 1. row ***************************
  Field: id
   Type: int unsigned
   Null: NO
    Key: PRI
Default: NULL
  Extra: auto_increment
*************************** 2. row ***************************
  Field: age
   Type: tinyint unsigned
   Null: NO
    Key: UNI
Default: 18
  Extra: 
*************************** 3. row ***************************
  Field: sex
   Type: enum('male','famale')
   Null: YES
    Key: 
Default: NULL
  Extra: 
3 rows in set (0.00 sec)

```

psï¼šmysqlä¸­`:`è¡¨ç¤ºä»¥è¡¨ç¤ºå½¢å¼æ˜¾ç¤ºç»“æœï¼Œ'\G'è¡¨ç¤ºä»¥ä¸€è¡Œä¸€è¡Œçš„å½¢å¼æ˜¾ç¤º